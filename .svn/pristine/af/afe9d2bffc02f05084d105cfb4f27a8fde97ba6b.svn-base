@{
    ViewBag.Title = "导航页配置";
 
}

@Scripts.Render("~/bundles/jquery")
@Scripts.Render("~/bundles/easyui")
@Styles.Render("~/Content/icon")
<link rel="stylesheet" type="text/css" href="../Content/themes/metro-orange/easyui.css" title="orange">
<link rel="stylesheet" type="text/css" href="../Content/themes/metro-red/easyui.css" title="pink">
<link rel="stylesheet" type="text/css" href="../Content/themes/ui-cupertino/easyui.css" title="blue">
<link rel="stylesheet" type="text/css" href="../Content/themes/metro-gray/easyui.css" title="gray">
<link rel="stylesheet" type="text/css" href="../Content/themes/metro-green/easyui.css" title="green">
<script src="~/Scripts/CompanyInfo.js" type="text/javascript"></script>
<script src="~/Scripts/ratete.js"></script>
@Scripts.Render("~/bundles/common")
<body style="width:100%;height:100%;" class="easyui-layout">


    <div data-options="region:'north'" style="height:30px;background-color:#F2F5F7">
        @*按钮*@
        @*<a id="btnSave" href="javascript:void(0)" class="easyui-linkbutton" data-options="iconCls:'icon-tip'" onclick="ChangeDT()" style="width: 100px; position: absolute;  right: 860px; ">更换底图</a>
        <a id="btnSave" href="javascript:void(0)" class="easyui-linkbutton" data-options="iconCls:'icon-add'" onclick="AddText()" style="width:100px;position:absolute;right:740px">添加文字</a>
        <a id="btnSave" href="javascript:void(0)" class="easyui-linkbutton" data-options="iconCls:'icon-add'" onclick="EditText()" style="width:100px;position:absolute;right:620px">编辑文字</a>
        <a id="btnSave" href="javascript:void(0)" class="easyui-linkbutton" data-options="iconCls:'icon-add'" onclick="Add()" style="width:100px;position:absolute;right:500px">新增动画</a>

        <a id="btnSave" href="javascript:void(0)" class="easyui-linkbutton" data-options="iconCls:'icon-edit'" onclick="Edit()" style="width:100px;position:absolute;right:380px">编辑动画</a>*@
        <span style="font-size:14px">页面:</span>
        <select class="easyui-combobox" id="ChooseSysCode" style="width: 100px">
        </select>
       
        <a id="btnSave" href="javascript:void(0)" class="easyui-linkbutton" data-options="iconCls:'icon-tip'" onclick="Select()" style="width:100px;position:absolute;left:160px">选择</a>
        <a id="btnSave" href="javascript:void(0)" class="easyui-linkbutton" data-options="iconCls:'icon-tagblue'" onclick="AddText()" style="width: 100px; position: absolute; left: 280px; ">添加文字</a>
        <a id="btnSave" href="javascript:void(0)" class="easyui-linkbutton" data-options="iconCls:'icon-edit'" onclick="EditThis()" style="width: 100px; position: absolute; left: 400px; ">编辑</a>
    
        <a id="btnSave" href="javascript:void(0)" class="easyui-linkbutton" data-options="iconCls:'icon-remove'" onclick="Delete()" style="width: 100px; position: absolute; left: 520px; ">删除</a>
        <a id="btnSave" href="javascript:void(0)" class="easyui-linkbutton" data-options="iconCls:'icon-save'" onclick="Save()" style="width:100px;position:absolute;left:640px">保存</a>
        <a id="btnSave" href="javascript:void(0)" class="easyui-linkbutton" data-options="iconCls:'icon-reload'" onclick="LoadGif(SysCode)" style="width:100px;position:absolute;left:760px">刷新</a>
    </div>
    <div data-options="region:'west',fit:true" style="height:100%;" onclick="AddImg(event)">
        @*<div style="position: absolute; top: 30px; right: 310px;height:10px ">test</div>*@
        <img src="" id="GroundPic" style="position: absolute; width: 100%; height: 100%;" alt="" />
        @*Gif图*@
       
        <div style="width:100%;height:100%;position:absolute;top:1px;left:1px" id="divMain">  </div>
    

    </div>
    @*文字编辑弹出框*@
    <div id="AddTextDiv" class="easyui-window" title="文字设置" style=" text-align:center;width:550px;height:300px;" data-options="modal:true,closed:true,minimizable:false">
        <div>

        </div>
        <table style=" margin: 20px 0px 0px 55px;" id="table1">
            <tr>
                <td>
                    <span>显示类型：</span>
                </td>
                <td>
                    <input type="radio" name="TextType" id="WB" value="WB" checked="checked" /><label for="WB">输出文本</label>
                    <input type="radio" name="TextType" id="SJ" value="SJ" /><label for="SJ">数据文本</label>
                </td>
            </tr>
        </table>

        <table id="WBTable" style=" margin: 30px 0px 0px 55px">
            <tr>
                <td>
                    <span>显示文本：</span>
                </td>
                <td>
                    <div class="easyui-textbox" id="WBText" style="width: 350px"> </div>
                </td>
            </tr>
        </table>
        <table id="SJTable" style="display: none; margin: 0px 0px 0px 55px">
            <tr>
                <td>
                    <span>设备类型：</span>
                </td>
                <td>
                    <select class="easyui-combobox" id="TTextType" style="width: 350px">
                        <option value="A">模拟量</option>
                        <option value="D">开关量</option>
                        <option value="C">控制量</option>
                        <option value="L">累计量</option>
                        @*<option value="F">分站/设备</option>*@
                    </select>
                </td>
            </tr>
            <tr>
                <td>
                    <span>设备名：</span>
                </td>
                <td>
                    <div class="easyui-combogrid" id="TextTypeName" style="width: 350px"> </div>

                </td>
            </tr>
            <tr>
                <td>
                    <span>测点编号：</span>
                </td>
                <td>
                    <div class="easyui-combogrid" id="TextSensorNum" style="width: 350px"> </div>
                </td>
            </tr>

            <tr>
                <td>
                    <span>显示格式：</span>
                </td>

                <td>
                    <div>
                        <table style="width:350px">
                            <tr>
                                <td>
                                    <input type="checkbox" value="Type" id="GSTextType" /><label for="GSTextType">设备类型</label>
                                </td>
                                <td>
                                    <input type="checkbox" value="TypeName" id="GSTextTypeName" /><label for="GSTextTypeName">设备名</label>
                                </td>
                                <td>
                                    <input type="checkbox" value="SensorNum" id="GSTextSensorNum" /><label for="GSTextSensorNum">测点编号</label><br>
                                </td>
                            </tr>
                            <tr>
                                <td>
                                    <input type="checkbox" value="Place" id="GSTextPlace" /><label for="GSTextPlace">安装位置</label>
                                </td>
                                <td>
                                    <input type="checkbox" value="Value" id="GSTextValue" checked="checked" disabled="disabled" /><label for="GSTextValue">值</label>
                                </td>
                                <td>

                                    <input type="checkbox" value="Unit" id="GSTextUnit" /><label for="GSTextUnit">单位</label>
                                </td>
                            </tr>
                        </table>
                    </div>


                </td>

            </tr>
        </table>


        <span id="TextID" style="display:none"> </span>
        <a id="btnSave" href="javascript:void(0)" class="easyui-linkbutton" data-options="iconCls:'icon-save'" onclick="SaveTextAdd()" style="width:100px;margin:40px 0px 0px 0px ">保存</a>
        &nbsp;&nbsp;&nbsp;&nbsp;
        <a id="btnSave" href="javascript:void(0)" class="easyui-linkbutton" data-options="iconCls:'icon-save'" onclick="CloseText()" style="width: 100px; margin: 40px 0px 0px 0px">关闭</a>

    </div>

    @*图片弹出框*@
    <div id="EditImg" class="easyui-window" title="编辑图片" style=" text-align:center;width:550px;height:300px;" data-options="modal:true,closed:true,minimizable:false">
        <center>

            <form id="ff" name="ff" method="post" enctype="multipart/form-data">
                <table id="table" style="width: 500px; text-align: center; margin: 40px 0px 0px 0px; font-size: 14px; ">
                    <tr>
                        <td>
                            <span>设备类型</span>
                        </td>
                        <td>

                            <select class="easyui-combobox" id="ImgType" style="width: 350px;" data-options="disabled:true">
                                @*<option value="A">模拟量</option>*@
                                <option value="D" selected="selected">开关量</option>
                                @*<option value="C">控制量</option>
            <option value="L">累计量</option>*@
                                @*<option value="F">分站/设备</option>*@
                            </select>
                        </td>
                    </tr>

                    <tr>
                        <td>
                            <span>设备名</span>
                        </td>
                        <td>

                            <div class="easyui-combogrid" id="ImgTypeName" data-options="valueField:'id',textField:'TypeName'" style="width: 350px"> </div>
                        </td>
                    </tr>

                    <tr>
                        <td>
                            <span>测点安装位置</span>
                        </td>
                        <td>
                            <div class="easyui-combogrid" id="ImgSensorNum" style="width: 350px"> </div>
                        </td>
                    </tr>

                    <tr>
                        <td>
                            <span>图片大小</span>
                        </td>
                        <td>
                            <span>宽</span>   <span class="easyui-textbox" id="ImgWidth" style="width: 150px"> </span>
                            &nbsp;
                            <span>高</span>   <span class="easyui-textbox" id="ImgHeight" style="width: 150px"> </span>
                        </td>
                    </tr>

                    <tr >
                        <td>
                            <span>旋转角度</span>
                        </td>
                        <td>
                             <span class="easyui-textbox" id="ImgAngle" style="width:230px"> </span><span>度</span> <span>（顺时针旋转）</span>  
                            
                        </td>
                    </tr>

                </table>
            </form>
        </center>
        <span id="GifID" style="display:none"> </span>
        <a id="btnSave" href="javascript:void(0)" class="easyui-linkbutton" data-options="iconCls:'icon-save'" onclick="SaveEdit()" style="width:100px;margin:40px 0 0 0 ">确定</a>
        &nbsp;&nbsp;&nbsp;&nbsp;
        <a id="btnSave" href="javascript:void(0)" class="easyui-linkbutton" data-options="iconCls:'icon-save'" onclick="Close()" style="width:100px;margin:40px 0 0 0 ">关闭</a>
    </div>


  @*图形配置*@
    <div title="图形配置" data-options="region:'east',collapsible:false" style="width:150px;height:100%" id="TXPZ">
        @*隐藏表单*@
        
        <form id="AddImg" method="post" enctype="multipart/form-data"  style="display:none">
            <input type="file" id="AddFile" name="AddFile" onchange="SaveFile()" />
        </form>
        @*实际折叠窗口*@
        <div id="divTree" class=" easyui-accordion" style="width:100%;height:99%">
            <div title="动态图" style="width:100%;height:105%;overflow-y:hidden" >
                <a id="btnSave" href="javascript:void(0)" class="easyui-linkbutton" data-options="iconCls:'icon-edit'" style="width:100%" onclick="ADD(0)">导入动画</a>
               
                <div id="SetGIF" style="width:100%;height:100%;overflow-y:auto"> </div>
             </div>
            <div title="底图" style="width:100%;height:100%;overflow-y:hidden">
                <a id="btnSave" href="javascript:void(0)" class="easyui-linkbutton" data-options="iconCls:'icon-edit'" style="width:100%" onclick="ADD(1)">导入底图</a>
              
                <div id="SetGroundImg" style="width:100%;height:100%;overflow-y:auto"> </div>
            </div>
            <div title="静态图" style="width:100%;height:100%;overflow-y:hidden">
                <a id="btnSave" href="javascript:void(0)" class="easyui-linkbutton" data-options="iconCls:'icon-edit'" style="width:100%" onclick="ADD(2)">导入静态图</a>
                
                <div id="SetJPG" style="width:100%;height:100%;overflow-y:auto"> </div>
            </div>
        </div>

    </div>
    
    <div id="MessageBox" class="easyui-dialog" title="提示" data-options="modal:true,closed:true" style="height:180px;width:300px;text-align:center;vertical-align:middle;">
        <br />
        <br />
        <br />
        <label id="Message" style="padding-top:50px; vertical-align:middle;">操作失败</label>
        <div>
            <a id="CloseThis" href="javascript:void(0)" class="easyui-linkbutton" data-options="onClick:function(){    $('#MessageBox').window('close');  }" style="width: 100px;top:130px;left:100px;position:absolute">
                确定
            </a>
        </div>
    </div>
 
 
</body>
<script type="text/javascript">
    var changeList = [];
    var deleteList = [];
    drag = "dd";
    move = 0;
    var SysCode = '@ViewBag.Message';
    var GroundImg_Origin = "";
    var TextType = "WB";// 文本 WB或数据SJ 类型
    var AddIndex = -1;
    var AddRemark = -1;//0 动态图 1底图 2静态图 3文字 -1初始值
    var IsChangeGroundImg = 0;
    var GroundImgNmae = "";
    var AddCount = 0;
    var IsSelect = 0;
    var LastSelect = "";
    var CurrentSelect = "";
    var ImgType = 0;
    var DivCount = 0;
    var counts = [];
    var json;
    var TextID = "";
    if ('@ViewBag.Message' == "") {
        SysCode = "DH";
    }
    LoadTypeName("D", "#Img");

    $('input:radio[name="TextType"]').change(function () {
        TextType = $("input[name='TextType']:checked").val();
        if (TextType == "WB") {
            document.getElementById("WBTable").style.display = "block";
            document.getElementById("SJTable").style.display = "none";
        }
        else {
            document.getElementById("WBTable").style.display = "none";
            document.getElementById("SJTable").style.display = "block";
        }
    });
    $(document).ready(function () {
        // Gif 停止与开始
        if ('getContext' in document.createElement('canvas')) {
            HTMLImageElement.prototype.play = function () {
                if (this.storeCanvas) {
                    // 移除存储的canvas
                    this.storeCanvas.parentElement.removeChild(this.storeCanvas);
                    this.storeCanvas = null;
                    // 透明度还原
                    image.style.opacity = '';
                }
                if (this.storeUrl) {
                    this.src = this.storeUrl;
                }
            };
            HTMLImageElement.prototype.stop = function () {
                var canvas = document.createElement('canvas');
                // 尺寸
                var width = this.width, height = this.height;
                if (width && height) {
                    // 存储之前的地址
                    if (!this.storeUrl) {
                        this.storeUrl = this.src;
                    }
                    // canvas大小
                    canvas.width = width;
                    canvas.height = height;
                    // 绘制图片帧（第一帧）
                    canvas.getContext('2d').drawImage(this, 0, 0, width, height);
                    // 重置当前图片
                    try {
                        this.src = canvas.toDataURL("image/gif");
                    } catch (e) {
                        // 跨域
                        this.removeAttribute('src');
                        // 载入canvas元素
                        canvas.style.position = 'absolute';
                        // 前面插入图片
                        this.parentElement.insertBefore(canvas, this);
                        // 隐藏原图
                        this.style.opacity = '0';
                        // 存储canvas
                        this.storeCanvas = canvas;
                    }
                }
            };
            // Gif 停止与开始 end
        }
        ChangeLocation();
        window.onresize = function () {

            ChangeLocation();
        }
        $("#ChooseSysCode").combobox("setValue", SysCode);
        var id = "#" + SysCode
        $(id).attr("checked", "checked");

    });

    LoadConfigImg();
    function LoadConfigImg() {
        $.ajax({
            url: '../DH/LoadConfigImg?test=test' + getUrlStafix(),
            type: 'post',
            datatype: 'json',
            success: function (data) {
                if (data.data == "") {
                    document.getElementById("Message").innerText = "请先导入图片";
                    $("#MessageBox").window("open");
                }
                else {
                    document.getElementById("SetGIF").innerHTML = "";
                    document.getElementById("SetGroundImg").innerHTML = "";
                    document.getElementById("SetJPG").innerHTML = "";
                    var json = $.parseJSON(data.data);
                    for (var i = 0; i < json.length; i++) {
                        var div = document.createElement("div");
                        div.id = "DivResource" + json[i].ID
                        div.style.width = 100 + "px";
                        div.style.height = 100 + "px";
                        div.style.margin = "0 auto";
                        div.style.textAlign = "center";
                        var span = document.createElement("div");
                        span.id = "SPResource" + json[i].ID
                        span.innerHTML = json[i].ImgName;

                        var img = document.createElement("img");
                        img.id = "Resource" + json[i].ID;
                        img.style.width = 50 + "px";
                        img.style.height = 50 + "px";
                        img.src = json[i].ImgSrc;
                        img.style.padding = "5px 0 5px 0 ";
                        img.style.cursor = "pointer";
                        img.setAttribute("onclick", "AddThis(" + json[i].ID + ",'" + json[i].Remark + "')");
                        div.appendChild(img);
                        div.appendChild(span);
                        switch (json[i].Remark) {
                            case 0:
                                document.getElementById("SetGIF").appendChild(div);
                                break;
                            case 1:
                                document.getElementById("SetGroundImg").appendChild(div);
                                break;
                            case 2:
                                document.getElementById("SetJPG").appendChild(div);
                                break;

                        }
                    }

                }

            },
            error: function () {
                document.getElementById("Message").innerText = "获取数据失败，请检查网络";
                $("#MessageBox").window("open");

            }

        });

    }

    function InitCombo(obj)
    {
        var comboTypeName = "#" + obj + "TypeName";
        var comboSesorNum = "#" + obj + "SensorNum";



    }
    // 从右侧图片栏中点击
    function AddThis(index, Remark) {
        IsSelect = 0;
        AddIndex = index;
        AddRemark = Remark;
        // 如果是底图直接 更换
        if (Remark == 1) {
            IsChangeGroundImg = 1

            GroundImgNmae = document.getElementById("Resource" + index).src;
            document.getElementById("GroundPic").src = document.getElementById("Resource" + index).src;
        }
        if (CurrentSelect != "") {
            var div = document.getElementById(CurrentSelect);
            div.style.border = "0px solid #000";
            CurrentSelect = "";
        }

    }

    function InitEditImg() {
        $("#ImgType").combobox("setValue", "D");
        $("#ImgTypeName").combogrid("setValue", "");
        $("#ImgSensorNum").combogrid("setValue", "");
        $("#ImgWidth").textbox("setText", document.getElementById(CurrentSelect).clientWidth);
        $("#ImgHeight").textbox("setText", document.getElementById(CurrentSelect).clientHeight);
        $("#ImgAngle").textbox("setText", "0");
    }
    function InitEditText() {
        var Selected = document.getElementsByName("TextType");
        Selected[0].checked = true;
        document.getElementById("WBTable").style.display = "block";
        TextType = "WB";
        document.getElementById("SJTable").style.display = "none";
        $("#WBText").textbox("setText", "");

        $("#TTextType").combobox("setValue", "");
        $("#TextTypeName").combogrid("setValue", "");
        $("#TextSensorNum").combogrid("setValue", "");

        $("#GSTextType").removeAttr("checked");
        $("#GSTextTypeName").removeAttr("checked");
      
        $("#GSTextPlace").removeAttr("checked");
        $("#GSTextSensorNum").removeAttr("checked");
        $("#GSTextUnit").removeAttr("checked");

    }
    //编辑窗口
    function EditThis() {
        if (CurrentSelect != "") {
            var Re = document.getElementById(CurrentSelect + "_Remark").innerHTML;

            if (Re == "3") {
                InitEditText();
                var Selected = document.getElementsByName("TextType");
                Selected[0].checked = true;
                document.getElementById("WBTable").style.display = "block";
                TextType = "WB";
                document.getElementById("SJTable").style.display = "none";
                $("#WBText").textbox("setText", document.getElementById(CurrentSelect + "_Sen").innerHTML);
                $("#AddTextDiv").window("open");


            }
            else if (Re == "4") {


                InitEditText();
                TextType = "SJ";
                var Selected = document.getElementsByName("TextType");
                Selected[1].checked = true;
                document.getElementById("WBTable").style.display = "none";

                document.getElementById("SJTable").style.display = "block";

                $("#TTextType").combobox("setValue", document.getElementById(CurrentSelect + "_Type").innerHTML);
                LoadTypeName(document.getElementById(CurrentSelect + "_Type").innerHTML, "#Text");
                LoadSensor(document.getElementById(CurrentSelect + "_TypeName").innerHTML, "#Text");
                $("#TextTypeName").combogrid("setValue", document.getElementById(CurrentSelect + "_TypeName").innerHTML);
                $("#TextSensorNum").combogrid("setValue", document.getElementById(CurrentSelect + "_Sen").innerHTML);


                var va = document.getElementById(CurrentSelect + "_Va").innerHTML;
                var listVa = va.split("|");
                var listChe = [];
                listChe.push("GSTextType");
                listChe.push("GSTextTypeName");
                listChe.push("GSTextSensorNum");
                listChe.push("GSTextPlace");
                listChe.push("GSTextUnit");
                for (var i = 0; i < listVa.length-1; i++) {
                    if (listVa[i] == "1") {
                        $("#" + listChe[i]).prop("checked", true);
                    }
                    else {
                        $("#" + listChe[i]).prop("checked", false);
                    }
                }
                $("#AddTextDiv").window("open");
            }
            else {
            
                    if (document.getElementById(CurrentSelect + "_Type").innerHTML != "") {

                        $("#ImgType").combobox("setValue", 'D');
                        LoadTypeName('D', "#Img");
                        LoadSensor(document.getElementById(CurrentSelect + "_TypeName").innerHTML, "#Img");
                        $("#ImgTypeName").combogrid("setValue", document.getElementById(CurrentSelect + "_TypeName").innerHTML);
                        $("#ImgSensorNum").combogrid("setValue", document.getElementById(CurrentSelect + "_Sen").innerHTML);
                    }
                    else {
                        LoadTypeName("D", "#Img");
                        LoadSensor("", "#Img");
                        $("#ImgType").combobox("setValue", "D");
                        $("#ImgTypeName").combogrid("setValue", "");
                        $("#ImgSensorNum").combogrid("setValue", "");
                    }
                    $("#ImgWidth").textbox("setText", document.getElementById(CurrentSelect + "_Img").clientWidth);
                    $("#ImgHeight").textbox("setText", document.getElementById(CurrentSelect + "_Img").clientHeight);
                    var angle = document.getElementById(CurrentSelect).style.transform;
                    if (angle != "")
                        $("#ImgAngle").textbox("setText", angle.substring(7, angle.indexOf("d")));
                    else
                    {
                        $("#ImgAngle").textbox("setText", "0");
                    }
                    $("#EditImg").window("open");
                }
          


        }
        else {
            document.getElementById("Message").innerText = "请先选择。\n当图片或文字出现黑框时，即为选中状态";
            $("#MessageBox").window("open");

        }
       
    }
   
    $("#TTextType").combobox({
        onChange: function (newValue, OldValue) {
            if (newValue != "") {
                LoadTypeName(newValue, "#Text");
            }

        }
    });


    function LoadTypeName(obj, id) {
        var ComboID = id + "TypeName";
        ;
        $(ComboID).combogrid({
            url: '../DH/LoadTypeName?SysCode=' + SysCode + "&Type=" + obj + getUrlStafix(),
            idField: 'TypeCode',
            textField: 'TypeName',
            panelWidth: 350,
            multiple: false,
            columns: [[
                  { field: 'TypeCode', title: '测点编号', width: 60,hidden:true },
            { field: 'TypeName', title: '测点类型', width: 180 },
             { field: 'Unit', title: '单位', width: 160 },
            ]],
            onSelect: function (rowIndex,rowData) {
                LoadSensor(rowData.TypeCode, id );
            }
        });

    }

    function LoadSensor(obj, id) {
        var ComboID =  id + "SensorNum";
        $(ComboID).combogrid({
            url: '../DH/LoadSensor?SysCode=' + SysCode + "&Type=" + encodeURI(obj),
            idField: 'SensorNum',
            textField: 'Place',
            panelWidth: 350,
            multiple: false,
            columns: [[
                  { field: 'SensorNum', title: '测点编号', width: 60 },
            { field: 'TypeName', title: '测点类型', width: 80 },
            { field: 'Place', title: '安装位置', width: 145 },
             { field: 'Unit', title: '单位', width: 60 },
            ]],
            onSelect: function (rowData) {

            }
        });
    }



    function SaveEdit() {
        var an = $("#ImgAngle").textbox("getText");
       if (an != "")
        {
           if (!/^[0-9]*$/.test(an)) {
               document.getElementById("Message").innerText = "只能输入整数";
               $("#MessageBox").window("open");
               return false;

           }
           if (parseInt(an) < 0 || parseInt(an)>360) {

               document.getElementById("Message").innerText = "旋转角度只能输入0-360之间";
               $("#MessageBox").window("open");
               return false;
           }

       }
       var wid = $("#ImgWidth").textbox("getText");
       var hei = $("#ImgHeight").textbox("getText");
       if (wid != "")
       {
           if (!/^[0-9]*$/.test(wid)) {
               document.getElementById("Message").innerText = "图片宽度只能输入整数";
               $("#MessageBox").window("open");
               return false;

           }
           if (parseInt(wid) == 0 || parseInt(wid) > 1000) {

               document.getElementById("Message").innerText = "图片宽度不合适，范围1-1000";
               $("#MessageBox").window("open");
               return false;
           }
       }


       if (hei != "") {
           if (!/^[0-9]*$/.test(hei)) {
               document.getElementById("Message").innerText = "图片高度只能输入整数";
               $("#MessageBox").window("open");
               return false;

           }
           if (parseInt(hei) == 0 || parseInt(hei) > 1000) {

               document.getElementById("Message").innerText = "图片高度不合适，范围1-1000";
               $("#MessageBox").window("open");
               return false;
           }
       }

        document.getElementById(CurrentSelect + "_Sen").innerHTML = $("#ImgSensorNum").combogrid("getValue");
        document.getElementById(CurrentSelect).style.width = $("#ImgWidth").textbox("getText");
        document.getElementById(CurrentSelect + "_Img").style.width = $("#ImgWidth").textbox("getText");
        document.getElementById(CurrentSelect).style.height = $("#ImgHeight").textbox("getText");
        document.getElementById(CurrentSelect + "_Img").style.height = $("#ImgHeight").textbox("getText");

        document.getElementById(CurrentSelect).style.transform = "rotate(" + $("#ImgAngle").textbox("getText") + "deg)";
        document.getElementById(CurrentSelect + "_Type").innerHTML = $("#ImgType").combobox("getValue");
        document.getElementById(CurrentSelect + "_TypeName").innerHTML = $("#ImgTypeName").combogrid("getValue");



        if ($("#ImgSensorNum").combogrid("getValue") != null && $("#ImgSensorNum").combogrid("getValue") != "") {
            document.getElementById(CurrentSelect + "_Img").textContent = "关联测点：" + $("#ImgSensorNum").combogrid("getValue");
            document.getElementById(CurrentSelect + "_Img").addEventListener("mouseover", function () {
                var tValue = this.textContent;
                this.setAttribute("title", tValue);
            }, false);
        }

        IsAddList(CurrentSelect);
        $("#EditImg").window("close");
    }

    // 当前选择的div是否要增加至changelist中
    function IsAddList(obj) {
        var flag = 0;
        for (var i = 0; i < changeList.length; i++) {
            if (changeList[i] == obj) {
                flag = 1;
                break;
            }
        }
        if (flag == 0) {
            changeList.push(obj);
        }
    }

  

    //左侧点击添加右侧点击过图片
    function AddImg(event) {
      
        if (AddRemark == 1) {
            return false;
        }
        if ((AddIndex != -1 && AddRemark != -1) || AddRemark==3) {
            // 非初始值 Index 为左侧图片的id remark为左侧图片类型（动态图、静态图）
            AddCount++;
            TextID = "";
            var e = event || window.event;


            var div = document.createElement("div");
            var sen = document.createElement("span");
            var div = document.createElement("div");
            var re = document.createElement("span");
            var ty = document.createElement("span");
            var tyn = document.createElement("span");
            sen.innerHTML = "";

            div.style.position = "absolute";
            div.id = "New" + AddCount;
            div.setAttribute("onclick", "SelectThis('" + div.id + "','" + AddRemark + "')");
            div.style.left = e.clientX + "px";
            div.style.top = e.clientY + "px";
            sen.id = "New" + AddCount + "_Sen";
            re.id = "New" + AddCount + "_Remark";
            ty.id = "New" + AddCount + "_Type";
            tyn.id = "New" + AddCount + "_TypeName";

            re.innerHTML = AddRemark;
            re.style.display = "none";
            sen.style.display = "none";

            ty.style.display = "none";
            tyn.style.display = "none";

            div.style.width = "100px;"
            div.style.height = "100px;";
            div.style.cursor="pointer"
            document.getElementById("divMain").appendChild(div);
            document.getElementById("New" + AddCount).appendChild(sen);
            document.getElementById("New" + AddCount).appendChild(re);

            document.getElementById("New" + AddCount).appendChild(ty);
            document.getElementById("New" + AddCount).appendChild(tyn);


         
            if (AddRemark == 3) {
                InitEditText();
                LoadTypeName("", "#Text");
                LoadSensor("", "#Text");
                TextID = div.id;
                var sp = document.createElement("span");
                sp.id = "New" + AddCount + "_Sp";
                document.getElementById("New" + AddCount).appendChild(sp);
                $("#AddTextDiv").window("open");
            }
            else {
                IsAddList(div.id);
                LoadTypeName("", "#Img");
                LoadSensor("", "#Img");
                var img = document.createElement("img");
                img.src = document.getElementById("Resource" + AddIndex).src;
                img.id = "New" + AddCount + "_Img";
                document.getElementById("New" + AddCount).appendChild(img);
                div.style.width = img.clientWidth
                div.style.height = img.clientHeight;
            }


        }

    }

   //点击选择按钮
    function Select() {
        IsSelect = 1;
        AddRemark = -1;
    }
  
    // 选择某个图片
    function SelectThis(DivID, remark) {
        if (IsSelect == 1) {
            if (LastSelect == "") {
                LastSelect = DivID;
            }
            if (DivID != LastSelect) {
                var div2 = document.getElementById(LastSelect);
                div2.style.border = "0px solid #000";
                div2.setAttribute("onmousemove", "");
                div2.setAttribute("onmousedown", "");
                div2.setAttribute("onmouseup", "");
                div2.setAttribute("ondragstart", "");
                div2.setAttribute("onmouseover", "");
                LastSelect = DivID;
                move = 0;
            }
            CurrentSelect = DivID;
            var div = document.getElementById(DivID);
            TextID = DivID;
            div.style.border = "1px solid #000";
            div.setAttribute("onmousemove", "mousemove()");
            div.setAttribute("onmousedown", "mousedown()");
            div.setAttribute("onmouseup", "mouseup()");
            div.setAttribute("ondragstart", "mouseStop()");
            div.setAttribute("onmouseover", "dragimages =" + DivID + "; drag = '" + DivID + "';");

        }
    }


    //无需修改位置时注释 start
    function mousedown() {

        if (CurrentSelect) {
            X1 = window.event.x - parseInt(document.getElementById(CurrentSelect).style.left);
            Y1 = window.event.y - parseInt(document.getElementById(CurrentSelect).style.top);
            document.getElementById(CurrentSelect).style.Index += 1;
            move = 1;
        }
    }
    function mouseStop() {
        window.event.returnValue = false;
    }
    function mousemove() {

        if (move) {

            document.getElementById(CurrentSelect).style.left = window.event.x - X1;
            document.getElementById(CurrentSelect).style.top = window.event.y - Y1;
        }
    }
    function mouseup() {

        IsAddList(CurrentSelect)

        move = 0;
    }
    //无需修改位置时注释 end

    LoadGraph(SysCode);

    function ChangeLocation() {
        //alert("1");
        LoadGraph(SysCode);
        LoadGif(SysCode);
    }

    function LoadALL(obj) {

        SysCode = obj;
        LoadGraph(SysCode);
        LoadGif(SysCode);
    }
    $("#ChooseSysCode").combobox({
        url: '../DH/LoadSysList?test=test' + getUrlStafix(),
      
        valueField: 'id',
        textField: 'ChildSysName',
        onSelect: function (rowData) {
            IsSelect = 0;
            LastSelect = "";
             AddIndex = -1;
             AddRemark = -1;
             IsChangeGroundImg = 0;
              changeList = [];
              deleteList = [];
             drag = "dd";
             move = 0;
              GroundImg_Origin = "";
               TextType = "WB";// 文本 WB或数据SJ 类型
               AddIndex = -1;
               AddRemark = -1;//0 动态图 1底图 2静态图 3文字 -1初始值
               IsChangeGroundImg = 0;
               GroundImgNmae = "";
               AddCount = 0;
               IsSelect = 0;
               LastSelect = "";
               CurrentSelect = "";
               ImgType = 0;
               DivCount = 0;
               counts = [];
               json="";

               ;
               SysCode = rowData.id;
            LoadGraph(SysCode);
            LoadGif(SysCode);
            LoadTypeName("D", "#Img");
        }
    });

    function LoadSensorNums(obj) {
        var senID = "#" + obj;
        $(senID).combogrid({
            url: '../Center/ReturnLDKZ?rows=20' + '&Type=' + SysCode,
            panelWidth: 350,
            panelHeight: 300,
            pageSize: 20,
            idField: 'SensorNum',
            textField: 'SensorNum',
            multiple: false,
            striped: true,
            pagination: true,
            columns: [[
         //{ field: 'select', title: '选择', checkbox: true, width: 40 },
        { field: 'SensorNum', title: '测点编号', width: 60 },

        { field: 'TypeName', title: '测点类型', width: 80 },
        { field: 'Place', title: '安装位置', width: 150 },
        { field: 'Type', title: '类型', width: 40 },
            ]],
        });
        var p = $(senID).combogrid('grid').datagrid('getPager');
        p.pagination({
            showPageList: false,
            beforePageText: '第',//页数文本框前显示的汉字
            layout: ['first', 'prev', 'next', 'last', 'manual'],
            afterPageText: '共 {pages} 页',
        });
    }



    function AddText() {
        AddRemark = 3;
        IsSelect = 0;
        if (CurrentSelect != "")
        {
            var div = document.getElementById(CurrentSelect);
            div.style.border = "0px solid #000";
            CurrentSelect = "";
        }

    }

    function EditText() {

        LoadSensorNums("textSensorNum2");

        if (deleteList.length != 1) {
            document.getElementById("Message").innerText = "请先选择，最多只能选择一个";
            $("#MessageBox").window("open");
            return false;
        }
        $.ajax({
            url: '../DH/LoadSingleText',
            datatype: 'json',
            type: 'post',
            data: { "ID": deleteList.toString() },
            success: function (data) {
                var singleGif = $.parseJSON(data.data);
                $("#TextID").html(singleGif[0].ID);
                $("#TextContent").textbox("setText", singleGif[0].Name);
                $("#textSensorNum2").combogrid("setValue", singleGif[0].SensorNum);
                $("#black").attr("checked", "checked");


                $('#ImgSrc2').attr("disabled", true);
                //$("#ImgSrc").filebox("setValue", singleGif[0].ImageSrc);
                //$("#ImgSrc").filebox("readonly", true);
                $("#AddText").window("setTitle", "编辑文字");
                //$('#AddGif').window('options').title = "编辑";
                $("#AddText").window("open");

            },
            error: function (e) {
                document.getElementById("Message").innerText = "获取数据失败，请检查网络";
                $("#MessageBox").window("open");
            }
        });





    }
    // 记录图片类型
   

    // 保存导入文件
    function SaveFile() {
        $.ajaxFileUpload(
        {
            url: "../DH/SaveFile?Remark=" + encodeURI(ImgType) + "&ImgName=" + encodeURI($("#AddFile")[0].value),//用于文件上传的服务器端请求地址
            secureuri: false, //一般设置为false
            fileElementId: 'AddFile', //文件上传空间的id属性  <input type="file" id="file" name="file" />
            dataType: 'json', //返回值类型 一般设置为json
            success: function (data)  //服务器成功响应处理函数
            {
                document.getElementById("Message").innerText = data.msg;
                $("#MessageBox").window("open");
                //LoadGif(SysCode);
                LoadConfigImg();
            },
            error: function (data, status, e)//服务器响应失败处理函数
            {
                document.getElementById("Message").innerText = "请检查网络!";
                $("#MessageBox").window("open");
            }
        }
    );
    }


    // 导入图片按钮
    function ADD(obj) {
        ImgType = obj;
        // 触发选择文件事件
        return $("#AddFile").click();

    }



    function Close() {
        $("#EditImg").window("close");
    }
  

    // ie：根据每次请求url，若参数相同则自动过滤不执行
    function getUrlStafix() {
        var myDate = new Date();
        return "&myDate=" + myDate.getFullYear() + myDate.getMonth() + myDate.getDate() + myDate.getHours() + myDate.getMinutes() + myDate.getSeconds();
    }

    // 加载底图
    function LoadGraph(SysCode) {
        document.getElementById("GroundPic").style.width = document.body.clientWidth - 150;
        document.getElementById("GroundPic").style.height = document.body.clientHeight - 30;
        //document.getElementById("GroundPic").src = '../DH/LoadGraph?SysCode=' + SysCode + getUrlStafix();;
        $.ajax({
            url: '../DH/LoadGraph?SysCode=' + SysCode + getUrlStafix(),
            datatype: 'json',
            type: 'post',
            success: function (data) {
                document.getElementById("GroundPic").src = data.data;
            },
            error: function (e) {
                document.getElementById("Message").innerText = "加载底图失败,请检查网络!";
                $("#MessageBox").window("open");
            }

        });
    }


    // gif停止与开始  0是文字 ，1 是动画
    function ControlGif(i, flag, Divid) {
        counts[i]++;
        if (counts[i] % 2 == 1) {
            document.getElementById("Message").innerText = "已选中该动画，现在你可以开始移动/删除/编辑";
            $("#MessageBox").window("open");
            var div = document.getElementById(Divid);
            deleteList.push(Divid);
            div.style.border = "1px solid #000";
            div.setAttribute("onmousemove", "mousemove()");
            div.setAttribute("onmousedown", "mousedown()");
            div.setAttribute("onmouseup", "mouseup()");
            div.setAttribute("ondragstart", "mouseStop()");
            div.setAttribute("onmouseover", "dragimages = " + Divid + "; drag = '" + Divid + "';");

        }
        else {
            document.getElementById("Message").innerText = "选中结束";
            $("#MessageBox").window("open");
            var div = document.getElementById(Divid);
            div.style.border = "0px solid #000";
            div.setAttribute("onmousemove", "");
            div.setAttribute("onmousedown", "");
            div.setAttribute("onmouseup", "");
            div.setAttribute("ondragstart", "");
            div.setAttribute("onmouseover", "");
            for (var i = 0; i < deleteList.length; i++) {
                if (deleteList[i] == Divid) {
                    deleteList.splice(i, 1);
                    break;
                }
            }

        }

    }
    // gif停止与开始  end
    function Show(obj) {
        switch (obj) {
            case "WS": window.open("http://172.16.18.198"); break;
            case "TF": window.open("http://172.16.18.50"); break;
        }
    }

    LoadGif(SysCode);

    //加载动画
    function LoadGif(obj) {
        changeList = [];
        deleteList = [];
        counts = [];
        $.ajax({
            url: '../DH/LoadGif?SysCode=' + obj + getUrlStafix(),
            datatype: 'json',
            type: 'post',
            success: function (data) {
                LastSelect = "";
                var par = document.getElementById("divMain");
                json = $.parseJSON(data.data);
                par.innerHTML = "";
                if (json.length > 0) {
                    DivCount = json.length;
                    var width = document.getElementById("GroundPic").clientWidth;
                    var height = document.getElementById("GroundPic").clientHeight;
                    for (var i = 0; i < json.length; i++) {
                        counts.push(0);
                        var divID = "div" + json[i].DivID;
                        var div = document.createElement("div");
                        div.setAttribute("id", divID);
                        div.style.width = json[i].RateW + "px";
                        div.style.height = json[i].RateH + "px";
                        div.style.position = "absolute";
                        div.style.top = json[i].RateT * height + "px";
                        div.style.left = json[i].RateL * width + "px";

                        var sen = document.createElement("span");
                        sen.id = div.id + "_Sen";
                        var re = document.createElement("span");
                        re.id = div.id + "_Remark";

                        var ty = document.createElement("span");
                        ty.id = div.id + "_Type";
                    

                        var tyn = document.createElement("span");
                        tyn.id = div.id + "_TypeName";

                        tyn.style.display = "none";
                        ty.style.display = "none";
                        re.style.display = "none";
                        re.innerHTML = json[i].Tag;
                        sen.innerHTML = json[i].SensorNum;
                        tyn.innerHTML = json[i].TypeCode;
                        if (json[i].Types == "" || json[i].Types==null)
                        {
                            ty.innerHTML ="";
                        }
                       else   ty.innerHTML = json[i].Types;

                        div.appendChild(sen);
                        div.appendChild(re);
                        div.appendChild(tyn);
                        div.appendChild(ty);

                        sen.style.display = "none";
                        sen.style.display = "none";
                        div.style.cursor = "pointer";

                        div.setAttribute("onclick", "SelectThis('" + div.id + "','" + json[i].Tag.toString() + "')");
                        // 3是文本 4是数据
                        if (json[i].Tag.toString() == "3")
                        {
                            div.style.backgroundColor = "#FF9933";
                            div.style.width = json[i].RateW + "px";
                            div.style.height = json[i].RateH + "px";
                            var con = document.createElement("span");
                            con.setAttribute("id", div.id + "_Sp");
                            con.innerHTML = json[i].SensorNum + " 文本";

                        
                            div.appendChild(con);
                          
                        }
                        else if (json[i].Tag.toString() == "4") {
                            ;
                            div.style.backgroundColor = "#FF9933";
                            div.style.width = json[i].RateW + "px";
                            div.style.height = json[i].RateH + "px";
                            var con = document.createElement("span");
                            con.setAttribute("id", div.id + "_Sp");
                            con.innerHTML = json[i].SensorNum + " 数据";
                            var va = document.createElement("span");
                            va.setAttribute("id", div.id + "_Va");
                            va.innerHTML = json[i].setValue;
                            va.style.display = "none";
                            div.appendChild(va);
                            div.appendChild(con);

                           
                        }
                        else {
                            var img = document.createElement("img");
                            img.setAttribute("id", div.id + "_Img");

                            if (json[i].SensorNum != null && json[i].SensorNum != "") {
                                img.textContent = "关联测点："+ json[i].SensorNum;
                            }
                            img.addEventListener("mouseover", function () {
                                var tValue = this.textContent;
                                this.setAttribute("title", tValue);
                            }, false);
                            
                            img.style.cursor = "pointer";
                            img.style.width = json[i].RateW + "px";
                            img.style.height = json[i].RateH + "px";
                            img.src = json[i].ImageSrc;
                          
                            div.appendChild(img);
                            div.style.transform = "rotate(" + json[i].Angle + "deg)"
                         
                        }
                        par.appendChild(div);
                    }
                }
            },
            error: function (e) {
                document.getElementById("Message").innerText = "加载动画失败,请检查网络!";
                $("#MessageBox").window("open");
            }
        });

    }

    //  保存按钮事件
    function Save() {

        var RateL = [];
        var RateT = [];
        var SensorNums = [];

        var Values = [];
        var Tags = [];
        var Indexs = [];

        var ImgSrcs = [];
        var RateWs = [];
        var RateHs = [];
        var IsEdits = [];
        var temp = [];
        var Angles = [];
        if (changeList.length > 0 || IsChangeGroundImg == 1) {
            $.messager.progress();	// 显示进度条
            //区分 是否 更新动画  0动画有更改 1只换底图
            var Tip = 0;
            if (changeList.length == 0) {
                Tip = 1;
            }

            for (var i = 0; i < changeList.length; i++) {
                var id = changeList[i];
                var div = document.getElementById(id);
                if (div == null)
                {
                    continue;
                }
                temp.push(id);
                var rateL = parseFloat(div.style.left.substring(0, div.style.left.length - 2)) / (document.getElementById("GroundPic").clientWidth);
                var rateT = parseFloat(div.style.top.substring(0, div.style.top.length - 2)) / (document.getElementById("GroundPic").clientHeight);

                SensorNums.push(document.getElementById(changeList[i] + "_Sen").innerHTML);

                Tags.push(document.getElementById(changeList[i] + "_Remark").innerHTML);
                Indexs.push("---");
                if (document.getElementById(changeList[i] + "_Remark").innerHTML == "3") {
                    Values.push("---");
                    ImgSrcs.push("");
                    Angles.push("0");
                    RateWs.push(parseFloat(document.getElementById(changeList[i]).clientWidth));
                    RateHs.push(parseFloat(document.getElementById(changeList[i]).clientHeight));


                }
                else if (document.getElementById(changeList[i] + "_Remark").innerHTML == "4") {
                    ImgSrcs.push("");
                    Angles.push("0");
                    RateWs.push(parseFloat(document.getElementById(changeList[i]).clientWidth));
                    RateHs.push(parseFloat(document.getElementById(changeList[i]).clientHeight));
                    Values.push(document.getElementById(changeList[i] + "_Va").innerHTML);
                }
                else {
                    Values.push("---");
                    var tempAngle = document.getElementById(changeList[i]).style.transform;
                    if (tempAngle != "")
                    {
                        Angles.push(tempAngle.substring(7, tempAngle.indexOf("d")));
                    }
                    else  Angles.push("0");
                    ImgSrcs.push(document.getElementById(changeList[i] + "_Img").src);
                    RateWs.push(parseFloat(document.getElementById(changeList[i] + "_Img").clientWidth));
                    RateHs.push(parseFloat(document.getElementById(changeList[i] + "_Img").clientHeight));
                }
                IsEdits.push("---");
                RateL.push(rateL);
                RateT.push(rateT);

            }
            var ID = temp.toString();
            var l = RateL.toString();
            var t = RateT.toString();

            $.ajax({
                url: '../DH/SaveConfig',
                datatype: 'json',
                type: 'post',
                data: { "IDs": ID, "SensorNums": SensorNums.toString(), "Values": Values.toString(), "Tags": Tags.toString(), "Indexs": Indexs.toString(), "ImgSrcs": ImgSrcs.toString(), "RateWs": RateWs.toString(), "RateHs": RateHs.toString(), "RateLs": l, "RateTs": t, "SysCode": SysCode, "IsEdits": IsEdits.toString(), "IsChangeDT": IsChangeGroundImg, "DT": GroundImgNmae, "Tip": Tip, "Angles": Angles.toString()},
                success: function (data) {
                    $.messager.progress('close');
                    if (data.data) {
                        document.getElementById("Message").innerText = "保存成功";
                        $("#MessageBox").window("open");
                        LoadGif(SysCode);
                    }
                    else {
                        document.getElementById("Message").innerText = "保存失败";
                        $("#MessageBox").window("open");
                    }
                },

                error: function (e) {
                    $.messager.progress('close');
                    alert("保存失败，请检查网络连接。");
                }
            });
        }
        else {
            document.getElementById("Message").innerText = "无内容更改";
            $("#MessageBox").window("open");
        }

    }

    function Delete() {
     
        if (CurrentSelect == "") {
            document.getElementById("Message").innerText = "请先选择";
            $("#MessageBox").window("open");
            return false;
        }
        if (CurrentSelect.indexOf("New") >= 0) {
            //新加的
            var div = document.getElementById(CurrentSelect);
            document.getElementById("divMain").removeChild(div);
            if ($("#" + CurrentSelect).length > 0) {
                LastSelect = "";
                document.getElementById("Message").innerText = "删除失败";
                $("#MessageBox").window("open");

            } else {
                LastSelect = "";
                document.getElementById("Message").innerText = "删除成功";
                $("#MessageBox").window("open");

            }

        }
        else {
            $.messager.confirm("提示", "是否删除带黑框的图或文字？", function (r) {
                if (r) {
                    $.ajax({
                        url: '../DH/DeleteGif',
                        datatype: 'json',
                        type: 'post',
                        data: { "DeleteList": CurrentSelect },
                        success: function (data) {
                            LastSelect = "";
                            document.getElementById("Message").innerText = data.data;
                            $("#MessageBox").window("open");
                            var div = document.getElementById(CurrentSelect);
                            document.getElementById("divMain").removeChild(div);
                            //LoadGif(SysCode);
                        },
                        error: function (e) {
                            document.getElementById("Message").innerText = "删除失败，请检查网络";
                            $("#MessageBox").window("open");
                        }

                    });
                }
            });
        }
     
    }

    function ChangeDT() {
        GroundImg_Origin = document.getElementById("GroundPic").src;
        $("#ChangeDTDiv").window("open");
    }


    function CloseDT() {
        $("#ChangeDTDiv").window("close");
    }

    //预览
    function ReView() {
        var dtImg = document.getElementById("GroundPic");
        var file = document.getElementById("GroundSrc").files[0];
        var reader = new FileReader();
        reader.onloadend = function () {
            dtImg.src = reader.result;
        }
        if (file) {
            reader.readAsDataURL(file);
        } else {
            dtImg.src = "";
        }
    }

    function ReStore() {
        document.getElementById("GroundPic").src = GroundImg_Origin;

    }
  


    function SaveTextAdd() {
        if (TextID != "") {
          
            if (TextType == "WB") {
                if ($("#WBText").textbox("getText") == "") {
                    document.getElementById("Message").innerText = "请输入文本内容！";
                    $("#MessageBox").window("open");
                }
                else {
                    document.getElementById(TextID + "_Remark").innerHTML = "3";
                    document.getElementById(TextID + "_Sp").innerHTML = $("#WBText").textbox("getText") + "   文本";
                    document.getElementById(TextID + "_Sen").innerHTML = $("#WBText").textbox("getText");
                    var div = document.createElement("span");
                    div.innerHTML = $("#WBText").textbox("getText") + " 文本";
                    document.getElementById("divMain").appendChild(div);
                    document.getElementById(TextID).style.width = div.offsetWidth + 10 + "px";
                    document.getElementById(TextID).style.backgroundColor = "#FF9933";
                    document.getElementById("divMain").removeChild(div);
                    IsAddList(TextID);
                    $("#AddTextDiv").window("close");
                }
               
            }
            else {
                if ($("#TextSensorNum").combogrid("getValue") == "") {
                    document.getElementById("Message").innerText = "请选择测点编号！";
                    $("#MessageBox").window("open");
                }
                else {
                    document.getElementById(TextID + "_Remark").innerHTML = "4";
                    document.getElementById(TextID + "_Sp").innerHTML = $("#TextSensorNum").combogrid("getValue") + "   数据";
                    document.getElementById(TextID + "_Sen").innerHTML = $("#TextSensorNum").combogrid("getValue");
                    document.getElementById(TextID + "_TypeName").innerHTML = $("#TextTypeName").combogrid("getValue");
                    document.getElementById(TextID + "_Type").innerHTML = $("#TTextType").combobox("getValue");
                    var temp = document.createElement("span");
                    temp.innerHTML = $("#TextSensorNum").combogrid("getValue") + " 数据";
                    document.getElementById("divMain").appendChild(temp);
                    document.getElementById(TextID).style.width = temp.offsetWidth + 10 + "px";
                    document.getElementById(TextID).style.backgroundColor = "#FF9933";
                    document.getElementById("divMain").removeChild(temp);

                   

                   

                    var values = "";
                    //GSTextType  GSTextTypeName GSTextSensorNum GSTextPlace GSTextUnit
                    if ($('#GSTextType').is(':checked')) {
                        values += "1|";
                    }
                    else {
                        values += "0|";
                    }
                    if ($('#GSTextTypeName').is(':checked')) {
                        values += "1|";
                    }
                    else {
                        values += "0|";
                    }
                    if ($('#GSTextSensorNum').is(':checked')) {
                        values += "1|";
                    }
                    else {
                        values += "0|";
                    }
                    if ($('#GSTextPlace').is(':checked')) {
                        values += "1|";
                    }
                    else {
                        values += "0|";
                    }
                    if ($('#GSTextUnit').is(':checked')) {
                        values += "1|";
                    }
                    else {
                        values += "0|";
                    }
                    var vaID = "#" + TextID + "_Va";
                    if ($(vaID).length > 0) {
                        document.getElementById(TextID + "_Va").innerHTML = values;
                    }
                    else {
                        var va = document.createElement("span");
                        va.id = TextID + "_Va";
                        va.innerHTML = values;
                        va.style.display = "none";
                        document.getElementById(TextID).appendChild(va);
                    }
                    IsAddList(TextID);
                    $("#AddTextDiv").window("close");
                    
                }
               

            }
        }
      
    }
    function CloseText() {
        $("#AddTextDiv").window("close");

    }
</script>
